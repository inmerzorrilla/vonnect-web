"use strict";(()=>{var e={};e.id=227,e.ids=[227],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1515:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>f,patchFetch:()=>T,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>D,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{GET:()=>m,POST:()=>g});var r=t(5468),n=t(2197),a=t(4694),i=t(5685);let l=process.env.TELEGRAM_BOT_TOKEN,u=`https://api.telegram.org/bot${l}`,c=new Map;async function g(e){try{if(!l)return console.error("❌ TELEGRAM_BOT_TOKEN not configured"),i.NextResponse.json({success:!1,error:"Bot not configured",details:"TELEGRAM_BOT_TOKEN environment variable is missing"},{status:200});let{message:s,chatId:t,userName:o,userPhone:r,userEmail:n}=await e.json();if(!s||!t)return console.error("❌ Missing message or chatId:",{message:!!s,chatId:!!t}),i.NextResponse.json({success:!1,error:"Missing message or chatId"},{status:200});let a=process.env.TELEGRAM_CHAT_ID;if(console.log("\uD83D\uDD27 Telegram Chat ID from env:",a?"Set":"Not set"),!a){console.log("\uD83D\uDD0D Auto-detecting Telegram Chat ID...");let e=await fetch(`${u}/getUpdates?limit=100`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)return console.error("❌ Failed to get updates from Telegram API:",e.status),i.NextResponse.json({success:!1,error:"Failed to connect to Telegram API",details:`HTTP ${e.status}: ${e.statusText}`},{status:200});let s=await e.json();if(console.log("\uD83D\uDCE5 Telegram updates response:",{ok:s.ok,count:s.result?.length||0}),s.ok&&s.result.length>0){let e=s.result.filter(e=>e.message&&e.message.from&&!1===e.message.from.is_bot).sort((e,s)=>s.message.date-e.message.date);if(console.log("\uD83D\uDCE5 Found",e.length,"recent user messages"),e.length>0)a=e[0].message.from.id.toString(),console.log("✅ Auto-detected chat ID:",a),console.log("\uD83D\uDC64 User:",e[0].message.from.first_name,e[0].message.from.last_name||"");else{let e=s.result.filter(e=>e.message&&e.message.from&&!1===e.message.from.is_bot);e.length>0&&(a=e[0].message.from.id.toString(),console.log("✅ Fallback: Using chat ID:",a))}}if(!a)return console.error("❌ Could not determine Telegram chat ID"),i.NextResponse.json({success:!1,error:"Could not determine your Telegram chat ID. Please send a message to your bot @inmerzorrillabot first.",details:"No recent messages found in bot updates"},{status:200})}c.set(t,{telegramChatId:a,userName:o,userPhone:r,userEmail:n,lastActivity:Date.now()});let g=[];r&&"No proporcionado"!==r&&g.push(`📞 ${r}`),n&&"No proporcionado"!==n&&g.push(`📧 ${n}`);let m=g.length>0?`
${g.join("\n")}`:"",d=`💬 *Nuevo mensaje desde vonnect.net*

👤 Usuario: ${o||"An\xf3nimo"}${m}
📱 ID: ${t}

📝 Mensaje:
"${s}"

_Responde a este mensaje y aparecer\xe1 autom\xe1ticamente en el chat del sitio web._`;console.log("\uD83D\uDCE4 Sending message to Telegram chat ID:",a),console.log("\uD83D\uDCDD Formatted message length:",d.length);let p=await fetch(`${u}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:a,text:d,parse_mode:"Markdown"})});console.log("\uD83C\uDF10 Telegram API response status:",p.status);let h=await p.json();if(console.log("Telegram API response:",h),!h.ok)return console.error("Telegram API Error:",h),i.NextResponse.json({success:!1,error:"Failed to send message to Telegram",details:h.description||"Unknown error",chatId:a},{status:200});return i.NextResponse.json({success:!0,messageId:h.result?.message_id||"unknown",status:"sent"},{status:200})}catch(e){return console.error("Error sending to Telegram:",e),i.NextResponse.json({success:!1,error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:200})}}async function m(){return i.NextResponse.json({activeChats:Array.from(c.entries()),botToken:l?"Set":"Not set"})}let d=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/app/api/telegram/send/route",pathname:"/app/api/telegram/send",filename:"route",bundlePath:"app/app/api/telegram/send/route"},resolvedPagePath:"C:\\Users\\pc\\Desktop\\BrainTask - Vonnect\\Vonnect_Web\\vonnect_redesign\\app\\app\\api\\telegram\\send\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:D}=d,f="/app/api/telegram/send/route";function T(){return(0,a.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:h})}}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),o=s.X(0,[343,769],()=>t(1515));module.exports=o})();