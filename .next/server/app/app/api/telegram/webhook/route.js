"use strict";(()=>{var e={};e.id=643,e.ids=[643],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4096:(e,o,s)=>{s.r(o),s.d(o,{originalPathname:()=>b,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>u,serverHooks:()=>f,staticGenerationAsyncStorage:()=>_});var t={};s.r(t),s.d(t,{GET:()=>d,POST:()=>m});var a=s(5468),r=s(2197),n=s(4694),l=s(5685);let i=process.env.TELEGRAM_BOT_TOKEN,p=`https://api.telegram.org/bot${i}`,c=globalThis.__telegram_responses||(globalThis.__telegram_responses=new Map),g=globalThis.__telegram_timestamps||(globalThis.__telegram_timestamps=new Map);async function m(e){try{let o=await e.json();if(console.log("Webhook received update:",JSON.stringify(o,null,2)),o.message&&o.message.text){let e=o.message.text,s=o.message.from.id,t=o.message.chat.id;if(console.log(`Received message from ${s}: ${e}`),o.message.reply_to_message){let s=o.message.reply_to_message.text;console.log("Reply to message:",s),console.log(`ðŸ” Looking for chat ID in original message: "${s}"`);let a=s.match(/ðŸ“± ID: (.+)\n/);if(a){let s=a[1].trim();console.log(`ðŸŽ¯ Extracted web chat ID: "${s}"`);let r={message:e,timestamp:Date.now(),messageId:o.message.message_id,from:o.message.from.first_name||"Support"};c.set(s,r),g.set(s,Date.now()),console.log(`âœ… Response stored for web chat "${s}": ${e}`),console.log(`âœ… Total responses in memory: ${c.size}`),console.log(`ðŸ—‚ï¸ All stored chat IDs: ${Array.from(c.keys()).join(", ")}`),fetch(`${p}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:t,text:`âœ… Respuesta enviada al chat web: "${e}"`,reply_to_message_id:o.message.message_id})}).catch(e=>console.error("Failed to send confirmation:",e))}else console.log("No web chat ID found in original message")}else console.log("Direct message (not a reply to web chat)"),fetch(`${p}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:t,text:`ðŸ‘‹ \xa1Hola! Este es el bot de soporte de Vonnect.

ðŸ’¬ Para responder a los mensajes del sitio web, simplemente RESPONDE a los mensajes que te env\xedo con formato "ðŸ’¬ Nuevo mensaje desde vonnect.net"

ðŸ”§ Si necesitas ayuda, contacta al administrador.`})}).catch(e=>console.error("Failed to send auto-response:",e))}return l.NextResponse.json({ok:!0},{status:200})}catch(e){return console.error("Webhook error:",e),l.NextResponse.json({ok:!0},{status:200})}}async function d(e){try{let{searchParams:o}=new URL(e.url),s=o.get("chatId");if(console.log(`ðŸ” GET request for chatId: "${s}"`),!s)return console.log("âŒ Missing chatId in GET request"),l.NextResponse.json({error:"Missing chatId",response:null},{status:200});console.log(`ðŸ“Š Current stored responses: ${c.size} total`),console.log(`ðŸ—‚ï¸ Available chat IDs: [${Array.from(c.keys()).join(", ")}]`);let t=c.get(s);if(t)return c.delete(s),g.delete(s),console.log(`âœ… FOUND and removed response for chat "${s}":`,t.message),console.log(`âœ… Remaining responses in memory: ${c.size}`),l.NextResponse.json({response:t},{status:200});return console.log(`ðŸš« No response found for chat "${s}"`),l.NextResponse.json({response:null},{status:200})}catch(e){return console.error("GET webhook error:",e),l.NextResponse.json({response:null,error:"Internal error"},{status:200})}}globalThis.__telegram_cleanup_interval||(globalThis.__telegram_cleanup_interval=setInterval(()=>{let e=Date.now()-3e5,o=0;for(let[s,t]of g.entries())t<e&&(c.delete(s),g.delete(s),o++);o>0&&console.log(`ðŸ§¹ Cleaned up ${o} old responses. Remaining: ${c.size}`)},3e5));let u=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/app/api/telegram/webhook/route",pathname:"/app/api/telegram/webhook",filename:"route",bundlePath:"app/app/api/telegram/webhook/route"},resolvedPagePath:"C:\\Users\\pc\\Desktop\\BrainTask - Vonnect\\Vonnect_Web\\vonnect_redesign\\app\\app\\api\\telegram\\webhook\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:_,serverHooks:f}=u,b="/app/api/telegram/webhook/route";function y(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:_})}}};var o=require("../../../../../webpack-runtime.js");o.C(e);var s=e=>o(o.s=e),t=o.X(0,[343,769],()=>s(4096));module.exports=t})();